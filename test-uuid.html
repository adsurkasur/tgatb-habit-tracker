<!DOCTYPE html>
<html>
<head>
    <title>UUID Generation Test</title>
</head>
<body>
    <h1>UUID Generation Test</h1>
    <button onclick="testUUID()">Generate UUID</button>
    <div id="results"></div>

    <script>
        // Copy of our generateId function for testing
        function generateId() {
            // Use native crypto.randomUUID if available (modern browsers with HTTPS)
            if (typeof crypto !== 'undefined' && crypto.randomUUID) {
                return crypto.randomUUID();
            }
            
            // Fallback implementation for environments without crypto.randomUUID
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = (typeof crypto !== 'undefined' && crypto.getRandomValues) 
                    ? crypto.getRandomValues(new Uint8Array(1))[0] % 16
                    : Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function testUUID() {
            const uuid = generateId();
            const results = document.getElementById('results');
            results.innerHTML += '<p>Generated UUID: ' + uuid + '</p>';
            
            // Validate UUID format
            const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
            const isValid = uuidRegex.test(uuid);
            results.innerHTML += '<p>Valid UUID v4: ' + isValid + '</p><hr>';
            
            console.log('Generated UUID:', uuid, 'Valid:', isValid);
        }

        // Test crypto availability
        console.log('crypto available:', typeof crypto !== 'undefined');
        console.log('crypto.randomUUID available:', typeof crypto !== 'undefined' && !!crypto.randomUUID);
        console.log('crypto.getRandomValues available:', typeof crypto !== 'undefined' && !!crypto.getRandomValues);
    </script>
</body>
</html>
